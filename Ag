-- Pro Scripters V12 | Auto Grab System
-- Server-side safe for your game
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- CONFIG
local BrainrotValues = {
	Common = 5,
	Rare = 15,
	Epic = 40,
	Legendary = 120
}
local AUTO_GRAB_RANGE = 20

-- REMOTES
local remotes = ReplicatedStorage:FindFirstChild("ProScriptersRemotes") or Instance.new("Folder")
remotes.Name = "ProScriptersRemotes"
remotes.Parent = ReplicatedStorage

local toggleRemote = Instance.new("RemoteEvent")
toggleRemote.Name = "ToggleAutoGrab"
toggleRemote.Parent = remotes

local speedRemote = Instance.new("RemoteEvent")
speedRemote.Name = "UpdateSpeed"
speedRemote.Parent = remotes

local teleportRemote = Instance.new("RemoteEvent")
teleportRemote.Name = "TeleportBrainrot"
teleportRemote.Parent = remotes

-- Player Settings
local playerSettings = {}

Players.PlayerAdded:Connect(function(player)
	playerSettings[player] = {
		autoGrabEnabled = false,
		autoGrabSpeed = 0.3
	}

	player.CharacterAdded:Connect(function(character)
		local root = character:WaitForChild("HumanoidRootPart")

		-- Auto-Grab Loop
		task.spawn(function()
			while character.Parent do
				local settings = playerSettings[player]
				if settings.autoGrabEnabled then
					local folder = Workspace:FindFirstChild("Brainrots")
					if folder then
						for _, br in ipairs(folder:GetChildren()) do
							if br:IsA("BasePart") and br.Parent == folder then
								local distance = (br.Position - root.Position).Magnitude
								if distance <= AUTO_GRAB_RANGE then
									local stats = player:FindFirstChild("leaderstats")
									if stats then
										local brainrots = stats:FindFirstChild("Brainrots")
										if brainrots then
											local rarity = br:FindFirstChild("Rarity")
											local value = 5
											if rarity and BrainrotValues[rarity.Value] then
												value = BrainrotValues[rarity.Value]
											end
											brainrots.Value += value
											-- Magnet effect
											br.Position = root.Position
											br:Destroy()
										end
									end
								end
							end
						end
					end
				end
				task.wait(settings.autoGrabSpeed)
			end
		end)
	end)
end)

-- REMOTE HANDLERS
toggleRemote.OnServerEvent:Connect(function(player, enabled)
	if playerSettings[player] then
		playerSettings[player].autoGrabEnabled = enabled
	end
end)

speedRemote.OnServerEvent:Connect(function(player, speed)
	if playerSettings[player] then
		playerSettings[player].autoGrabSpeed = math.clamp(speed, 0.05, 5)
	end
end)

teleportRemote.OnServerEvent:Connect(function(player)
	local char = player.Character
	if not char then return end
	local root = char:FindFirstChild("HumanoidRootPart")
	if not root then return end

	local folder = Workspace:FindFirstChild("Brainrots")
	if folder and #folder:GetChildren() > 0 then
		local nearest, dist = nil, math.huge
		for _, br in ipairs(folder:GetChildren()) do
			local d = (br.Position - root.Position).Magnitude
			if d < dist then
				dist = d
				nearest = br
			end
		end
		if nearest then
			root.CFrame = CFrame.new(nearest.Position + Vector3.new(0,3,0))
		end
	end
end)
